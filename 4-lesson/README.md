# üìä –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–∞–±–æ—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –≤ ClickHouse

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üìä –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–∞–±–æ—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –≤ ClickHouse](#-–¥–æ–º–∞—à–Ω–µ–µ-–∑–∞–¥–∞–Ω–∏–µ-—Ä–∞–±–æ—Ç–∞-—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏-–≤-clickhouse)
	- [üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#-—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)
	- [üéØ –¶–µ–ª—å](#-—Ü–µ–ª—å)
	- [üìÅ –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö](#-–Ω–∞–±–æ—Ä-–¥–∞–Ω–Ω—ã—Ö)
	- [–ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#–∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
		- [1. –û–±—â–∏–π –¥–æ—Ö–æ–¥ –æ—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π](#1-–æ–±—â–∏–π-–¥–æ—Ö–æ–¥-–æ—Ç-–≤—Å–µ—Ö-–æ–ø–µ—Ä–∞—Ü–∏–π)
	- [2. –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ —Å –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏](#2-—Å—Ä–µ–¥–Ω–∏–π-–¥–æ—Ö–æ–¥-—Å-–æ–¥–Ω–æ–π-—Å–¥–µ–ª–∫–∏)
		- [3. –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏](#3-–æ–±—â–µ–µ-–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ-–ø—Ä–æ–¥–∞–Ω–Ω–æ–π-–ø—Ä–æ–¥—É–∫—Ü–∏–∏)
		- [4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –ø–æ–∫—É–ø–∫—É](#4-–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ-—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π-—Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö-–ø–æ–∫—É–ø–∫—É)
	- [–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö](#—Ñ—É–Ω–∫—Ü–∏–∏-–¥–ª—è-—Ä–∞–±–æ—Ç—ã-—Å-—Ç–∏–ø–∞–º–∏-–¥–∞–Ω–Ω—ã—Ö)
		- [1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ transaction\_date –≤ —Å—Ç—Ä–æ–∫—É —Ñ–æ—Ä–º–∞—Ç–∞ YYYY-MM-DD](#1-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ-transaction_date-–≤-—Å—Ç—Ä–æ–∫—É-—Ñ–æ—Ä–º–∞—Ç–∞-yyyy-mm-dd)
		- [2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–æ–¥–∞ –∏ –º–µ—Å—è—Ü–∞ –∏–∑ transaction\_date](#2-–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ-–≥–æ–¥–∞-–∏-–º–µ—Å—è—Ü–∞-–∏–∑-transaction_date)
		- [3. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ price –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ](#3-–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ-price-–¥–æ-–±–ª–∏–∂–∞–π—à–µ–≥–æ-—Ü–µ–ª–æ–≥–æ)
		- [4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ transaction\_id –≤ —Å—Ç—Ä–æ–∫—É](#4-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ-transaction_id-–≤-—Å—Ç—Ä–æ–∫—É)
	- [User-Defined Functions (UDFs)](#user-defined-functions-udfs)
		- [1. "UDF" –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏](#1-udf-–¥–ª—è-—Ä–∞—Å—á–µ—Ç–∞-–æ–±—â–µ–π-—Å—Ç–æ–∏–º–æ—Å—Ç–∏-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
		- [2. "UDF" –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–æ—Ä–æ–≥ = 100)](#2-udf-–¥–ª—è-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π-–ø–æ—Ä–æ–≥--100)

---

## üéØ –¶–µ–ª—å

–¶–µ–ª—å —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å:

- –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –§—É–Ω–∫—Ü–∏–∏, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (UDF), –≤ ClickHouse

---

## üìÅ –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

–ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:

```sql
CREATE TABLE transactions (
    transaction_id UInt32,
    user_id UInt32,
    product_id UInt32,
    quantity UInt8,
    price Float32,
    transaction_date Date
) ENGINE = MergeTree()
ORDER BY (transaction_id);
```

## –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –û–±—â–∏–π –¥–æ—Ö–æ–¥ –æ—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

```
SELECT SUM(quantity \* price) AS total_revenue
FROM transactions;
```

## 2. –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ —Å –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏

```
SELECT AVG(quantity \* price) AS avg_transaction_revenue
FROM transactions;
```

### 3. –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏

```
SELECT SUM(quantity) AS total_quantity_sold
FROM transactions;
```

### 4. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–≤–µ—Ä—à–∏–≤—à–∏—Ö –ø–æ–∫—É–ø–∫—É

```
SELECT COUNT(DISTINCT user_id) AS unique_users
FROM transactions;
```

## –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ transaction_date –≤ —Å—Ç—Ä–æ–∫—É —Ñ–æ—Ä–º–∞—Ç–∞ YYYY-MM-DD

```

SELECT transaction_id,
formatDateTime(transaction_date, '%Y-%m-%d') AS transaction_date_str
FROM transactions
LIMIT 5;
```

### 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥–æ–¥–∞ –∏ –º–µ—Å—è—Ü–∞ –∏–∑ transaction_date

```
SELECT transaction_id,
toYear(transaction_date) AS year,
toMonth(transaction_date) AS month
FROM transactions
LIMIT 5;
```

### 3. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ price –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Ü–µ–ª–æ–≥–æ

```
SELECT transaction_id,
price,
round(price) AS rounded_price
FROM transactions
LIMIT 5;
```

### 4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ transaction_id –≤ —Å—Ç—Ä–æ–∫—É

```
SELECT transaction_id,
toString(transaction_id) AS transaction_id_str
FROM transactions
LIMIT 5;
```

## User-Defined Functions (UDFs)

ClickHouse –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ø—Ä–∏–≤—ã—á–Ω–æ–º SQL-—Å—Ç–∏–ª–µ, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ clickhouse-local –∏–ª–∏ lambda-—Ñ—É–Ω–∫—Ü–∏–∏ (–≤–Ω—É—Ç—Ä–∏ array/map —Ñ—É–Ω–∫—Ü–∏–π). –ù–∏–∂–µ ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è UDF —Å –ø–æ–º–æ—â—å—é –≤—ã—Ä–∞–∂–µ–Ω–∏–π.

### 1. "UDF" –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```
SELECT transaction_id,
quantity \* price AS total_price
FROM transactions
LIMIT 5;
```

### 2. "UDF" –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–æ—Ä–æ–≥ = 100)

```
SELECT transaction*id,
quantity * price AS total*price,
IF(quantity * price >= 100, '–≤—ã—Å–æ–∫–æ—Ü–µ–Ω–Ω–∞—è', '–º–∞–ª–æ—Ü–µ–Ω–Ω–∞—è') AS transaction_category
FROM transactions
LIMIT 10;
```
