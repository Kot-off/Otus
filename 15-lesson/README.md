# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ ClickHouse

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ ClickHouse](#–∞–Ω–∞–ª–∏–∑-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏-–∑–∞–ø—Ä–æ—Å–æ–≤-–≤-clickhouse)
	- [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)
	- [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
	- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
	- [–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤](#–∞–Ω–∞–ª–∏–∑-–∑–∞–ø—Ä–æ—Å–æ–≤)
		- [–ó–∞–ø—Ä–æ—Å –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PK](#–∑–∞–ø—Ä–æ—Å-–±–µ–∑-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-pk)
		- [–ó–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PK](#–∑–∞–ø—Ä–æ—Å-—Å-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º-pk)
	- [–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤](#—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
	- [–í—ã–≤–æ–¥—ã üìä](#–≤—ã–≤–æ–¥—ã-)
		- [üîç –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:](#-–∫–ª—é—á–µ–≤—ã–µ-–Ω–∞–±–ª—é–¥–µ–Ω–∏—è)

## –í–≤–µ–¥–µ–Ω–∏–µ

–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ ClickHouse —Å –∞–Ω–∞–ª–∏–∑–æ–º:

- –†–∞–∑–Ω–∏—Ü—ã –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
- –ú–µ—Ç–æ–¥–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
CREATE DATABASE IF NOT EXISTS test_db;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º
CREATE TABLE test_db.performance_test
(
    id UInt32,
    event_date Date,
    category String,
    value Float32,
    description String
)
ENGINE = MergeTree()
PRIMARY KEY (id, event_date);
```

## –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞–ø—Ä–æ—Å –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PK

```sql
SELECT
    category,
    avg(value) AS avg_value
FROM test_db.performance_test
WHERE description LIKE '%important%'
GROUP BY category;
```

<details> <summary>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</summary>
–ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
–ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É
</details>

### –ó–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PK

```sql
SELECT
    category,
    sum(value) AS total
FROM test_db.performance_test
WHERE id BETWEEN 1000 AND 2000
  AND event_date >= '2023-01-01'
GROUP BY category;
```

<details> <summary>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</summary>
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
</details>

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ú–µ—Ç—Ä–∏–∫–∞ –ë–µ–∑ PK –° PK
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 1.8s 0.2s
–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫ 1M 15K
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU 85% 15%

## –í—ã–≤–æ–¥—ã üìä

<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0366d6; margin-top: 16px;">

### üîç –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**  
   üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PK —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ **5-10 —Ä–∞–∑**  
   ‚è±Ô∏è –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

2. **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**  
   üîë –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ**  
   üìê –í–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞**  
   üîé `EXPLAIN` –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–ª—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
   üìù –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

4. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**  
   üìã –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç —Ü–µ–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é  
   üìä –ü–æ–∑–≤–æ–ª—è—é—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

</div>

<div style="margin-top: 20px; padding: 15px; background: #f6f8fa; border-radius: 6px;">

üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:

- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ PK –≤ —É—Å–ª–æ–≤–∏—è—Ö WHERE, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ EXPLAIN –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–ª—é—á–µ–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

</div>
